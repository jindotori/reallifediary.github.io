---
title: Software Refactoring
layout: post
summary: Software Refactoring
featured-img: refactoring
---
## 리팩토링 목적

- 버그를 발견하기 쉽게 만든다.
- 기능을 추가하기 쉽게 만든다.
- 리뷰하기 쉽게 만든다.

## 리팩토링이 필요한 부분을 '악취'가 난다고 한다.

- 이해하기 어려운 부분.
- 수정하기 어려운 부분.
- 확장하기 어려운 부분.

## 악취를 나타내는 말

- 겹친다. (중복코드) -> 메서드 추출, 클래스 추츨, 널 객체 도입, 에러 코드를 예외 처리
- 너무 길다. -> 메서드 추출, 클래스 추츨
- 너무 많다. -> 중개자 제거, 클래스 인라인화, 메서드 인라인화
- 이름이 안맞는다. -> 메서드 추출, 메서드명 변경, 설명용 변수 도입, 임시 변수 분리
- 너무 공개적이다. -> 필드 캡슐화, 생성자를 팩토리 메서드로 치환
- 객체 지향답지 않다. -> 분류 코드를 클래스로 치환, 분류 코드를 하위 클래스로 치환

## 리팩토링 카탈로그
- 리팩토링의 목적과 절차를 카탈로그 형식으로 정리.
- <http://www.refactoring.com>

## 리팩토링 에센스
#### 스텝 바이 스텝
  - 두 가지 수정을 한꺼번에 하지 않기.
- 되돌리기 쉽게 하기.
  - 리팩토링 했지만 문제가 생겨서 쉽게 되돌려야 하기 위함.
- 단계마다 확인.
  - 각 단계마다 제대로 되고 있는 지 확인.
- 오래된 걸 새로운 걸로 바꿈.
  - 동작 상태를 유지하면서 새로운 코드를 추가해서 오래된 것이 모두 새로워지면 오래된 것을 제거함.


## 매직 넘버를 기호 상수로 치환

#### 매직 넘버를 써서 안될 이유
- 매직 넘버의 이유를 알기 어렵다.
- 매직 넘버는 수정하기 어려움.

#### 리팩토링 실행
1. 기호 상수 선언
- public static final 클래스 필드 사용하기(클래스 안에서만 사용할 경우 private 선)
- enum 사용하기
2. 기호 상수에 의존하는 다른 매직 넘버를 기호 상수 표현식으로 변환.

잘못한 예제)
~~~
public static final int MAX_INPUT_LENGTH = 100;
public static final int WORK_AREA_LENGTH = 200;
~~~

잘한 예제)
~~~
public static final int MAX_INPUT_LENGTH = 100;
public static final int WORK_AREA_LENGTH = MAX_INPUT_LENGTH * 2;
~~~

## 제어 플래그 삭제
#### 플래그
- 상태를 기록하고 처리 흐름을 제어하기 위한 boolean 타입 변수
#### 제어 플래그
- 처리 흐름을 제어할 때 사용하는 플래그

#### 제어 플래그 삭제하는 이유
- 프로그램을 읽기 편하게 함.
-> 제어 플래그 대신 break, continue, return 등을 써서 처리 흐름을 제어함.

#### break나 return을 쓰면 가독성이 좋아지는 이유
- break나 return을 본 순간 이후에 오는 코드를 읽지 않아도 되는 경우가 많음.

## 어셔선 도입
프로그래머의 의도를 확실히 밝히면서도 실행 시 조건이 반드시 성립함을 보장함.
~~~
assert value > 0;
~~~
'value > 0 임을 어서션한다.'
value > 0 이라면 아무일도 일어나지 않는다.
value > 0 이 아니라면 java.lang.AssertionError가 발생한다.

#### 어셔선 도입 이유
- 해당 부분에서 성립해야 할 조건이 명확해지고 소스 코드가 읽기 좋아짐.
- 버그를 빨리 발견 가능함.
- 어서션을 활성화하면 어서션이 성립하는지 자동으로 확인 가능함.
- 어서션을 비활성화하면 어서션이 무시되어 성능이 개선됨.

#### 어서션 도입 방법
- 소스 코드에서 '성립해야 할 조건' 찾기
- 조건을 포함한 어서션 작성
  - 어서션 내부에 부수 효과가 있는 코드를 작성하면 안됨.
- 적혀 있던 주석을 무의미하므로 주석 삭제
- 컴파일해서 테스트

[어서션 도입 전]

~~~
void method(int value) {
  // 여기서 value가 참이어야 함.
  ...
}
~~~

[어서션 도입 후]

~~~
void method(int value) {
  assert value > 0;
  ...
}
~~~
